---
title: 日常疑难杂症（一）
date: 2025-11-01 12:00:00 +0800
categories: [笔记, 计算机通用技术]
tags: [笔记, 开发, 总结, Windows魅力时刻]
description: HACKs are acceptable...
---

## 前言

本文收录了一些自己遇到的日常（简单）疑难杂症及对应处理，暂时命名为 1，后续如果收录的过多会考虑出 2 等；按每 10 条一则吧。

本文收录的大多数问题可能都比较蠢，但是 debug 确实还是挺有意思的。

> 与 Python/深度学习相关的 HACK 被单独收录在了[Python开发疑难杂症汇总]({% post_url 2025-08-10-Python开发疑难杂症汇总 %})，方便查阅。
> {: .prompt-info }

## 【Web 开发】视口到底有多大？

### 描述

该问题出现在一个被设计为沉浸式单页应用的移动端页面上。旧方案下页面采用 `height: 100vh; overflow: hidden;` 布局，旨在完全占满屏幕并严格禁止滚动。页面内容包含由 JS 动态生成的持续下落动画元素，在设计上离开屏幕时该元素被移除。

**错误现象：** 在移动端浏览器中，JS 生成的动画元素溢出了屏幕，页面右侧出现了意外的滚动条。这表明 `overflow: hidden` 声明失效，JS 生成的动画元素被视为可滚动内容。

此外，此问题在桌面设备（Windows）上无法复现。这是因为桌面模拟器仅能调整视口尺寸，无法真实模拟移动端浏览器 UI（地址栏、工具栏）的动态显隐行为和其对大视口单位 (100vh) 的精确影响。该问题也长期被 Chromium 等官方项目视为 vh 单位定义的预期行为，而非 Bug。标准化的 svh, lvh, dvh 单位直到后来才出现，旨在解决此痛点，但在本项目中效果不佳。

### 处理

为根除此问题，采用了`overflow: clip`，来替代原有的 `overflow: hidden`，通过更严格的裁剪行为彻底禁止任何滚动并更有效地处理溢出内容。通过这一替换，无需依赖 dvh 等现代单位或复杂的 JS 视口高度计算，直接、~~并非~~优雅地解决了由视口单位与动态 UI 交互引发的布局溢出问题。

## 【域名/自定页面】由自定义域名配置引发的依赖崩溃

### 描述

自己有了域名，将 GitHub Pages 上的 Jekyll 博客从默认子目录迁移至独立子域名时，构建流程意外中断，导致站点无法部署。

**错误现象：** GitHub Actions 工作流在执行 `bundle install` 步骤时失败，核心错误是尝试 Gem 安装 `sass-embedded (1.93.3)` 时，构建原生扩展失败。

**核心错误日志片段：**

```shell
Gem::Ext::BuildError: ERROR: Failed to build gem native extension.
...
rake aborted!
NameError: uninitialized constant JSON::Fragment
...
An error occurred while installing sass-embedded (1.93.3), and Bundler cannot continue.
```

**原因分析：**

1. **旧环境的容忍度：** 在使用默认 GitHub Pages 部署或未更新依赖时，构建环境可能使用的是旧版、预编译好的 Sass 依赖，或官方支持的 Jekyll/Sass 版本，从而避免了原生扩展构建。
2. **新配置的触发：** 更改 `_config.yml` 中的 `url`/`baseurl` 或 GitHub Pages 设置，**强制触发了 GitHub Actions 重新运行完整的依赖解析和安装**（即 `bundle install`）。
3. **冲突暴露：** 依赖解析器拉取了最新版本的 `sass-embedded` (1.93.3)。该版本在尝试构建其所需的原生扩展时，其 Rakefile 代码引用了 **`JSON::Fragment`** 这一常量。
4. **版本不兼容：** 构建环境使用的 **Ruby 版本为 3.1.6**，在该版本的标准库中，`JSON::Fragment` 未定义或无法被正确加载，从而导致 `NameError` 和 Gem 安装失败。

### 处理

升级 GitHub Actions 中的 Ruby 版本。

1. 定位到项目仓库中的 GitHub Actions Workflow 文件（通常是 `.github/workflows/jekyll.yml`）。

2. 修改设置 Ruby 版本的步骤，将其升级到已知兼容且更新的稳定版本：

   ```yaml
   - name: Set up Ruby
     uses: ruby/setup-ruby@v1
     with:
       ruby-version: "3.3" # 将 Ruby 版本从 3.1 升级到 3.3
       bundler-cache: true
   ```

在 Ruby 3.3 环境中，`sass-embedded` 成功安装，不再报告 `JSON::Fragment` 错误。站点构建和部署成功完成，`article.akutazehy.xyz` 恢复正常访问。

## 【Windows】由 Windows MPO 机制引发的浏览器画面撕裂

### 描述

在 Windows 11 环境下，使用 Chromium 系浏览器（Chrome / Edge）进行网页滚动或播放 1080p 视频时，出现明显的卡顿、撕裂、闪烁甚至短暂黑屏现象；问题在多任务切换、窗口化 VRR / G-Sync 场景下更易触发。

**原因分析：**

多平面叠加 ([MPO](https://learn.microsoft.com/en-us/windows-hardware/drivers/display/multiplane-overlay-support)) 是 Windows 的一项功能，旨在通过对多个显示层（例如视频、桌面和应用程序窗口）使用硬件加速合成来提升图形性能。然而，它被频繁汇报会导致一些问题，例如画面卡顿、闪烁、黑屏、GPU 驱动程序崩溃以及浏览器延迟——尤其是在 AMD 和 NVIDIA GPU 上。在某些硬件配置下（尤其是 AMD RX 5000/6000/7000 和 NVIDIA RTX 2000/3000/4000 系列），由于对叠加平面处理不当，MPO 可能会导致系统不稳定，尤其是在上下文切换或低帧率场景下。

### 处理

禁用 Windows 的 Multiplane Overlay，使显示管线回退到稳定的 DWM 合成模式：

在注册表路径`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\Dwm`中，创建一个名为`OverlayTestMode`的`DWORD`值，将其值设置为`00000005`并重启电脑。

系统不再使用存在缺陷的 Overlay 显示路径，浏览器帧统一经 DWM 合成并受 VSync 约束，画面撕裂与闪烁问题消失或显著缓解，显示行为恢复稳定。
